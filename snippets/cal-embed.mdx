export const CalEmbed = ({
  calLink = "dougwithseismic/30min",
  namespace = "30min",
  layout = "month_view",
  hideEventTypeDetails = false,
  height = "650px"
}) => {
  const [isLoaded, setIsLoaded] = React.useState(false);
  const embedId = `cal-inline-${namespace}-${Math.random().toString(36).substr(2, 9)}`;

  React.useEffect(() => {
    if (typeof window !== 'undefined' && !window.Cal) {
      const script = document.createElement('script');
      script.src = 'https://app.cal.com/embed/embed.js';
      script.async = true;
      script.onload = () => {
        setIsLoaded(true);
      };
      document.head.appendChild(script);

      window.Cal = window.Cal || function() {
        const cal = window.Cal;
        const args = arguments;
        if (!cal.loaded) {
          cal.ns = {};
          cal.q = cal.q || [];
          cal.loaded = true;
        }
        if (args[0] === "init") {
          const api = function() {
            api.q = api.q || [];
            api.q.push(arguments);
          };
          const ns = args[1];
          api.q = api.q || [];
          if (typeof ns === "string") {
            cal.ns[ns] = cal.ns[ns] || api;
            cal.q.push(args);
          }
        } else {
          cal.q.push(args);
        }
      };
    } else if (window.Cal) {
      setIsLoaded(true);
    }
  }, []);

  React.useEffect(() => {
    if (isLoaded && window.Cal) {
      window.Cal("init", namespace, { origin: "https://app.cal.com" });

      window.Cal.ns[namespace]("inline", {
        elementOrSelector: `#${embedId}`,
        config: { layout },
        calLink: calLink,
      });

      window.Cal.ns[namespace]("ui", {
        hideEventTypeDetails,
        layout
      });
    }
  }, [isLoaded, namespace, calLink, layout, hideEventTypeDetails, embedId]);

  return (
    <div
      id={embedId}
      style={{
        width: '100%',
        height: height,
        overflow: 'auto',
        borderRadius: '8px',
        border: '1px solid #e5e7eb'
      }}
    >
      {!isLoaded && (
        <div style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          height: '100%',
          backgroundColor: '#f9fafb'
        }}>
          <div style={{ textAlign: 'center' }}>
            <div style={{
              display: 'inline-block',
              width: '40px',
              height: '40px',
              border: '3px solid #e5e7eb',
              borderTopColor: '#7C3AED',
              borderRadius: '50%',
              animation: 'spin 1s linear infinite'
            }}>
              <style>{`
                @keyframes spin {
                  0% { transform: rotate(0deg); }
                  100% { transform: rotate(360deg); }
                }
              `}</style>
            </div>
            <p style={{ marginTop: '16px', color: '#6b7280', fontSize: '14px' }}>
              Loading calendar...
            </p>
          </div>
        </div>
      )}
    </div>
  );
};